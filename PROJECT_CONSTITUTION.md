# プロジェクト憲法 (Project Constitution)

この文書は、**Porker Memo** プロジェクトの開発プロセス全体を通じて、AIエージェントと人間が一貫した品質を維持するための最高規律である。すべての開発作業はこの憲法に基づき遂行される。

## 1. プロジェクトの目的と原則

### 目的
ポーカー（テキサスホールデム）のハンド履歴を記録・分析・管理するWebアプリケーション（PWA）を開発する。
ユーザーは主にスマートフォンから利用するため、**モバイルファースト**かつ**オフラインファースト**の体験を提供する。

### 基本原則
1.  **Functional Programming (FP):** 副作用を最小限に抑え、純粋関数推奨、イミュータビリティを重視する。
2.  **可読性と保守性:** コードは「書く」時間よりも「読む」時間が長いことを意識し、自己文書化されたコードを目指す。複雑なロジックは小さな関数に分割する。
3.  **堅牢なエラーハンドリング:** ユーザー体験を損なわないよう、エラーは適切に捕捉・処理し、予期せぬクラッシュを防ぐ。

## 2. 技術スタック (Strict)

以下の技術スタックを厳守すること。

-   **Framework:** React (TypeScript) + Vite
-   **Styling:** Tailwind CSS (レスポンシブデザイン標準)
-   **UI Component:** shadcn/ui (Radix UI Base) + Lucide React
-   **Form Management:** React Hook Form + Zod
-   **State/Database:** Dexie.js (IndexedDB wrapper) - **オフラインデータ永続化の中核**
-   **Date Utility:** date-fns
-   **Routing:** React Router DOM

## 3. アプリケーション要件

### 3.1. 詳細なハンド記録
-   **記録項目:** 日時, ポジション, 自分のハンド(2枚), ボード(最大5枚), 相手のハンド, アクション系列, 収支, メモ。
-   **UI/UX:** スマートフォンでのタップ操作に最適化。トランプ選択は直感的なグリッドUI等を採用する。

### 3.2. オフラインファースト
-   ネットワーク接続がない環境でも全機能が動作すること。
-   データは **Dexie.js** を用いてブラウザの IndexedDB に保存する。
-   サーバー通信は初期フェーズでは実装しない。

### 3.3. 閲覧・分析
-   過去のハンド履歴をリスト表示。
-   フィルタリング機能: 特定のハンド (例: AA, AK), ポジション, 勝敗, 日時などで絞り込み可能。

### 3.4. データ管理
-   データのバックアップ・移行用として、全データをJSON形式でエクスポート/インポートする機能を備える。

## 4. アーキテクチャ

-   **パターン:** コンポーネントベースアーキテクチャ (Atomic Designを緩やかに適用、あるいはFeature-based)
-   **フォルダ構造（必須）:**
    ```text
    src/
    ├── components/ # UIコンポーネント
    ├── utils/      # ユーティリティ関数
    ├── types/      # TypeScript型定義
    ├── hooks/      # Custom Hooks
    └── data/       # Dexie.js データベース設定・モデル
    ```

## 5. コーディング規約

-   **命名規則:**
    -   コンポーネント: `PascalCase` (例: `HandCard.tsx`)
    -   関数・変数: `camelCase` (例: `calculateWinRate`)
    -   定数: `UPPER_SNAKE_CASE`
-   **コンポーネント:** Classical Class Componentsは使用禁止。すべて **Functional Components** と Hooks で実装する。
-   **型定義 (TypeScript):**
    -   `any` 型の使用は原則禁止。
    -   すべての関数およびコンポーネントの Props には明示的な型アノテーションを必須とする。
    -   APIレスポンスやDBモデルには Zod スキーマを定義し、型推論を利用する。

## 6. テスト要件

-   **フレームワーク:** Jest, React Testing Library
-   **目標カバレッジ:** 80% 以上
-   **テスト種類:**
    -   Unit Test: ロジックの検証
    -   Component Test: UIの振る舞い検証
    -   Snapshot Test: UIコンポーネントの回帰テスト用

## 7. ドキュメンテーション

-   **JSDoc:** すべての公開関数、複雑なロジックを持つ内部関数には JSDoc コメントを記述する。
    -   Parameters, Return values, 例外などを明記。
-   **README.md:** プロジェクトルートに配置し、セットアップ方法、スクリプトの説明、アーキテクチャの概要を常に最新の状態に保つ。

## 8. 開発プロセス (Development Process: TDD)

AIエージェントの非決定性を制御し、堅牢なコードベースを築くため、以下の **TDD (Test-Driven Development)** サイクルを厳守する。

### 8.1. 基本サイクル
1.  **Red:** 失敗するテストを書く。機能が未実装であることを確認する。
2.  **Green:** テストをパスさせるための「最小限の」コードを書く。
3.  **Refactor:** テストが通る状態を維持しながら、コードを整理・最適化する。

### 8.2. 実装ステップ
機能を実装する際は、必ず以下の手順を踏むこと。

#### Step 1: TDDプランの生成 (Plan)
実装する機能の仕様（ビジネスルール）を整理し、チェックリスト形式の **TDDプラン** を作成する。
- 何をテストすべきか（入力、出力、例外）を網羅する。
- 複雑なロジックは小さな単位に分解する。

#### Step 2: 最初のテスト作成 (Red)
TDDプランの最初の項目のみを対象としたテストケースを作成・実行し、期待通りに失敗（Red）することを確認する。
- 既存のテストがない場合はテストファイルを作成する。

#### Step 3: ミニマム実装 (Green)
目の前の失敗しているテストだけをパスさせる最小限の実装を行う。
- この段階で完璧なコードを目指さない。

#### Step 4: リファクタリング (Refactor)
テストが通った後、可読性向上や重複排除などのリファクタリングを行う。
- リファクタリング後もテストが通ることを確認する。
- 完了後、TDDプランの項目にチェックを入れ、Step 2に戻る。

## 9. デバッグと自己修正 (Debugging & Self-Correction)

エラー発生時は、単なる修正作業に留まらず、AIエージェントの学習機会として以下のフローを実行する。

### 9.1. 根本原因分析 (Root Cause Analysis)
エラーログと関連コードを分析し、エラーの根本原因を特定する。
- 「どこで」起きたかだけでなく、「なぜ」起きたか（論理的欠陥、想定外の入力、型不整合など）を言語化する。

### 9.2. 自己反省 (Self-Reflection)
修正コードを生成する前に、**「なぜその間違いが起きたのか」** を自己反省する。
- 思考の盲点（例：エッジケースの考慮不足、仕様の誤解）を明示し、同じ過ちを繰り返さないための教訓とする。
- *Verbal Reinforcement:* 「今回の失敗は、入力データの境界値（エッジケース）に対する考慮が不足していたことに起因する」のように記述する。

## 10. 品質保証とドキュメンテーション (QA & Documentation)

### 10.1. テストカバレッジ向上 (Increasing Coverage)
- 実装完了後、カバレッジレポートを分析し、目標（80%）未達の箇所を特定する。
- 未テストのロジック（例外パス、分岐など）を網羅するテストケースを追加する。

### 10.2. READMEドキュメント (Documentation)
プロジェクトの完了時、またはマイルストーンごとに `README.md` を更新する。以下のセクションを必須とする。
- **プロジェクトタイトル & 概要**
- **主な機能 (Key Features)**
- **技術スタック (Tech Stack)**
- **セットアップと実行方法 (Setup & Usage):** Install, Dev, Test コマンド
- **フォルダ構造 (Project Structure)**
